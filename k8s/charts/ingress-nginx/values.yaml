# Ingress NGINX configuration for Kind cluster
ingress-nginx:
  controller:
    # Single replica for Kind (only control-plane has ingress-ready label and hostPort mapping)
    replicaCount: 1

    # Use hostPort for Kind cluster (ports 80/443 are mapped in kind-config.yaml)
    hostPort:
      enabled: true
      ports:
        http: 80
        https: 443

    # Required for Kind: run on control-plane node with ingress-ready label
    nodeSelector:
      ingress-ready: "true"

    # Tolerate control-plane taint
    tolerations:
      - key: "node-role.kubernetes.io/control-plane"
        operator: "Exists"
        effect: "NoSchedule"

    # Use host network for direct access
    hostNetwork: false

    # Service configuration - use ClusterIP since hostPort handles external access
    service:
      type: ClusterIP

    # Resource limits
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi

    # HA: Liveness and readiness probes
    livenessProbe:
      httpGet:
        path: /healthz
        port: 10254
        scheme: HTTP
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 3
      failureThreshold: 3
      successThreshold: 1

    readinessProbe:
      httpGet:
        path: /healthz
        port: 10254
        scheme: HTTP
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 3
      failureThreshold: 3
      successThreshold: 1

    # Enable metrics for Prometheus
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
        namespace: monitoring

    # Admission webhooks
    admissionWebhooks:
      enabled: true

    # Update strategy for Kind (single replica with hostPort)
    # Must use maxUnavailable: 1 because hostPort prevents running 2 pods on same ports
    updateStrategy:
      type: RollingUpdate
      rollingUpdate:
        maxUnavailable: 1
        maxSurge: 0

    # No anti-affinity for Kind (single replica on control-plane only)
    affinity: {}

    # Autoscaling disabled for Kind (single node with hostPort)
    autoscaling:
      enabled: false

    # Pod Disruption Budget disabled for Kind
    podDisruptionBudget:
      enabled: false

    # Network Policy - allow all ingress traffic to controller
    networkPolicy:
      enabled: true

  # Default backend (optional)
  defaultBackend:
    enabled: false
